# SPDX-FileCopyrightText: the secureCodeBox authors
#
# SPDX-License-Identifier: Apache-2.0

name: IN PROGRESS - Documentation Roulette
on: push # TODO: Replace with cron

jobs:
  docu-roulette:
    runs-on: ubuntu-22.04
    #if: github.repository == 'secureCodeBox/secureCodeBox'
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
          ref: ${{ github.head_ref }}
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Fetch core-team members
        id: fetch-members
        run: |
          MEMBERS=$(gh api --paginate -X GET /orgs/secureCodeBox/teams/core-team/members)
          echo "MEMBERS=$MEMBERS" >> $GITHUB_OUTPUT
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Select the chosen member
        id: random-member
        run: |
          MEMBERS=(${{ steps.fetch-members.outputs.MEMBERS }})
          size=${#MEMBERS[@]}
          index=$(($RANDOM % $size))
          echo "MEMBER=${MEMBERS[$index]}" >> $GITHUB_ENV

      - uses: JasonEtco/create-an-issue@v2
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          filename: .github/ISSUE_TEMPLATE/documentation_roulette.md
